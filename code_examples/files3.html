<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <title>auto_esafe 파일 브라우저 (Mini)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    .folder-toggle{cursor:pointer;user-select:none}
    .sidebar{max-height:70vh;overflow:auto}
    .file-row:hover{background:#f8f9fa}
    .bi{width:1.2rem;display:inline-block}
  </style>
</head>
<body class="p-3" x-data="fsApp()">
  <div class="container">
    <div class="row g-3">

      <!-- 왼쪽: 폴더 트리 (auto_esafe/root + download + log 만 표시, download는 동적으로 하위폴더 확장) -->
      <div class="col-12 col-md-4 col-lg-3">
        <div class="card h-100">
          <div class="card-header fw-bold">폴더</div>
          <div class="card-body sidebar">

            <!-- auto_esafe 루트 -->
            <div class="mb-2">
              <div class="d-flex align-items-center gap-1 folder-toggle"
                   @click="select('C:/auto_esafe')">
                <i class="bi" :class="selected==='C:/auto_esafe' ? 'bi-folder2-open' : 'bi-folder2'"></i>
                <span class="fw-semibold">auto_esafe</span>
              </div>

              <!-- 하위: download / log -->
              <div class="ms-4 mt-2">
                <!-- download (동적 하위 폴더 렌더링) -->
                <div class="mb-1">
                  <div class="d-flex align-items-center gap-1 folder-toggle"
                       @click="toggle('C:/auto_esafe/download'); select('C:/auto_esafe/download')">
                    <i class="bi" :class="isOpen('C:/auto_esafe/download') ? 'bi-folder2-open' : 'bi-folder2'"></i>
                    <span>download</span>
                    <span class="ms-auto text-muted small" x-text="isOpen('C:/auto_esafe/download') ? '−' : '+'"></span>
                  </div>
                  <div class="ms-4 mt-1" x-show="isOpen('C:/auto_esafe/download')" x-transition>
                    <template x-for="sub in subfolders['C:/auto_esafe/download'] || []" :key="sub">
                      <div class="d-flex align-items-center gap-1 folder-toggle"
                           @click.stop="select(sub)">
                        <i class="bi" :class="selected===sub ? 'bi-folder2-open' : 'bi-folder2'"></i>
                        <span x-text="sub.split('/').slice(-1)[0]"></span>
                      </div>
                    </template>
                  </div>
                </div>

                <!-- log -->
                <div>
                  <div class="d-flex align-items-center gap-1 folder-toggle"
                       @click="select('C:/auto_esafe/log')">
                    <i class="bi" :class="selected==='C:/auto_esafe/log' ? 'bi-folder2-open' : 'bi-folder2'"></i>
                    <span>log</span>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- 오른쪽: 선택 폴더의 직속 파일 리스트 -->
      <div class="col-12 col-md-8 col-lg-9">
        <div class="card h-100">
          <div class="card-header d-flex align-items-center gap-2">
            <i class="bi bi-folder2-open"></i><span class="fw-bold">현재 경로:</span>
            <nav aria-label="breadcrumb"><ol class="breadcrumb mb-0">
              <template x-for="(seg,i) in breadcrumb" :key="i">
                <li class="breadcrumb-item" :class="{'active': i===breadcrumb.length-1}" x-text="seg"></li>
              </template>
            </ol></nav>
          </div>

          <div class="card-body p-0">
            <div class="p-2 border-bottom bg-light d-flex align-items-center gap-2">
              <input class="form-control form-control-sm" placeholder="이 폴더에서 파일 검색"
                     x-model="filterText" @input.debounce.200ms="applyFilter"/>
              <span class="badge text-bg-secondary ms-auto" x-text="`${filtered.length} files`"></span>
            </div>

            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th style="width:36px;"></th>
                    <th>파일명</th>
                    <th class="text-end" style="width:140px;">크기</th>
                    <th style="width:180px;">수정시각</th>
                  </tr>
                </thead>
                <tbody>
                  <template x-if="filtered.length===0">
                    <tr><td colspan="4" class="text-center text-muted py-4">파일이 없습니다</td></tr>
                  </template>
                  <template x-for="f in filtered" :key="f.path">
                    <tr class="file-row">
                      <td class="text-center"><i class="bi" :class="fileIcon(f.ext)"></i></td>
                      <td x-text="f.name"></td>
                      <td class="text-end" x-text="f.size || '-'"></td>
                      <td x-text="f.mtime || '-'"></td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>

          </div>
        </div>
      </div>

    </div>
  </div>

<script>
function fsApp(){
  // --- 데모 데이터 (올려준 구조를 요약 반영) ---
  const ROOT = 'C:/auto_esafe';

  // 루트 직속 파일 (예: exe 1개)
  const rootFiles = [
    { name:'auto_esafe_1.1.2.exe', ext:'exe', path:`${ROOT}/auto_esafe_1.1.2.exe`, size:'6.1 MB', mtime:'2025-02-14 07:00' }
  ];

  // download 내 파일들 (일부만 샘플)
  const downloadFiles = [
    { name:'20250318_500068_T2.xls',      ext:'xls', path:`${ROOT}/download/20250318_500068_T2.xls` },
    { name:'20250318_500068_T2.xls.csv',  ext:'csv', path:`${ROOT}/download/20250318_500068_T2.xls.csv` },
    { name:'20250515_500068_T2N.xls',     ext:'xls', path:`${ROOT}/download/20250515_500068_T2N.xls` },
    { name:'20250515_500086N.xls',        ext:'xls', path:`${ROOT}/download/20250515_500086N.xls` },
    { name:'20250515_500086N.xls.csv',    ext:'csv', path:`${ROOT}/download/20250515_500086N.xls.csv` },
  ];

  // log 내 파일들 (일부만 샘플)
  const logFiles = [
    { name:'auto_esafe_2025_02_17.log', ext:'log', path:`${ROOT}/log/auto_esafe_2025_02_17.log` },
    { name:'auto_esafe_2025_03_14.log', ext:'log', path:`${ROOT}/log/auto_esafe_2025_03_14.log` },
    { name:'auto_esafe_2025_05_01.log', ext:'log', path:`${ROOT}/log/auto_esafe_2025_05_01.log` },
    { name:'auto_esafe_2025_08_11.log', ext:'log', path:`${ROOT}/log/auto_esafe_2025_08_11.log` },
    { name:'error_2025_07_29_17_31_34.png', ext:'png', path:`${ROOT}/log/error_2025_07_29_17_31_34.png` },
  ];

  // 추후 실제 API 응답으로 교체 시, path만 맞춰주면 나머지는 그대로 동작
  const ALL = [...rootFiles, ...downloadFiles, ...logFiles];

  // util: 경로 도우미
  const dirname = p => p.replace(/[/\\]+$/,'').split('/').slice(0,-1).join('/') || p;
  const immediateChildrenOf = folder => {
    // 폴더 바로 아래 파일만 (하위폴더 속 파일 제외)
    const prefix = folder.endsWith('/') ? folder : folder + '/';
    return ALL.filter(f => f.path.startsWith(prefix) && f.path.slice(prefix.length).indexOf('/') === -1);
  };
  const findSubfolders = folder => {
    const prefix = folder.endsWith('/') ? folder : folder + '/';
    const set = new Set();
    ALL.forEach(f=>{
      if(!f.path.startsWith(prefix)) return;
      const rest = f.path.slice(prefix.length);
      const seg = rest.split('/')[0];
      if (seg && rest.includes('/')) set.add(prefix + seg);
    });
    return Array.from(set).sort();
  };

  return {
    // 상태
    selected: ROOT,                   // 초기 선택: auto_esafe
    breadcrumb: ['C:','auto_esafe'],
    filterText: '',
    files: [], filtered: [],
    openMap: { [`${ROOT}/download`]: true },  // download는 기본 열림 아님? 열림 토글 원하면 true/false
    subfolders: { },                  // 'C:/auto_esafe/download': ['C:/auto_esafe/download/2025', ...] 형태

    // 초기화
    init(){
      // download의 하위 폴더를 동적으로 계산
      this.subfolders[`${ROOT}/download`] = findSubfolders(`${ROOT}/download`);
      this.refreshFiles();
    },

    // 폴더 선택
    select(folderPath){
      this.selected = folderPath;
      this.breadcrumb = folderPath
        .replace(/^([A-Za-z]:)\/?/,'$1')
        .split('/')
        .filter(Boolean);

      // download 클릭 시마다 하위폴더 갱신 (실제 파일 변화 반영 가능)
      if (folderPath === `${ROOT}/download`) {
        this.subfolders[folderPath] = findSubfolders(folderPath);
      }
      this.refreshFiles();
    },

    // 열림/닫힘
    isOpen(path){ return !!this.openMap[path]; },
    toggle(path){ this.openMap[path] = !this.openMap[path]; },

    // 파일 리스트 갱신/필터
    refreshFiles(){
      if (this.selected === ROOT){
        this.files = immediateChildrenOf(ROOT);
      } else {
        this.files = immediateChildrenOf(this.selected);
      }
      this.applyFilter();
    },
    applyFilter(){
      const q = this.filterText.trim().toLowerCase();
      this.filtered = q ? this.files.filter(f=>f.name.toLowerCase().includes(q)) : [...this.files];
    },

    // 파일 아이콘
    fileIcon(ext){
      switch((ext||'').toLowerCase()){
        case 'exe': return 'bi-cpu';
        case 'xls': return 'bi-file-earmark-spreadsheet';
        case 'csv': return 'bi-filetype-csv';
        case 'log': return 'bi-journal-text';
        case 'png': return 'bi-filetype-png';
        default: return 'bi-file-earmark';
      }
    }
  };
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
