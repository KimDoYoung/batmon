<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8"/>
  <title>auto_esafe 파일 브라우저</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"/>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet"/>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.x.x/dist/cdn.min.js"></script>
  <style>
    .folder-toggle{cursor:pointer;user-select:none}
    .sidebar{max-height:70vh;overflow:auto}
    .file-row:hover{background:#f8f9fa}
    .bi{width:1.2rem;display:inline-block}
  </style>
</head>
<body class="p-3" x-data="fsApp()">
  <div class="container-fluid">
    <div class="row g-3">

      <!-- 좌측: 폴더 트리 -->
      <div class="col-12 col-md-4 col-lg-3">
        <div class="card h-100">
          <div class="card-header fw-bold">폴더</div>
          <div class="card-body sidebar">

            <!-- auto_esafe 루트 -->
            <div class="mb-2">
              <div class="d-flex align-items-center gap-1 folder-toggle"
                   @click="select(ROOT)">
                <i class="bi" :class="selected===ROOT ? 'bi-folder2-open' : 'bi-folder2'"></i>
                <span class="fw-semibold">auto_esafe</span>
              </div>

              <div class="ms-4 mt-2">
                <!-- download -->
                <div class="mb-1">
                  <div class="d-flex align-items-center gap-1 folder-toggle"
                       @click="toggle(ROOT+'/download'); select(ROOT+'/download')">
                    <i class="bi" :class="isOpen(ROOT+'/download') ? 'bi-folder2-open' : 'bi-folder2'"></i>
                    <span>download</span>
                    <span class="ms-auto text-muted small"
                          x-text="isOpen(ROOT+'/download') ? '−' : '+'"></span>
                  </div>
                  <div class="ms-4 mt-1" x-show="isOpen(ROOT+'/download')" x-transition>
                    <template x-for="sub in subfolders[ROOT+'/download'] || []" :key="sub">
                      <div class="d-flex align-items-center gap-1 folder-toggle"
                           @click.stop="select(sub)">
                        <i class="bi" :class="selected===sub ? 'bi-folder2-open' : 'bi-folder2'"></i>
                        <span x-text="sub.split('/').slice(-1)[0]"></span>
                      </div>
                    </template>
                  </div>
                </div>

                <!-- log -->
                <div>
                  <div class="d-flex align-items-center gap-1 folder-toggle"
                       @click="select(ROOT+'/log')">
                    <i class="bi" :class="selected===ROOT+'/log' ? 'bi-folder2-open' : 'bi-folder2'"></i>
                    <span>log</span>
                  </div>
                </div>
              </div>
            </div>

          </div>
        </div>
      </div>

      <!-- 우측: 파일 리스트 -->
      <div class="col-12 col-md-8 col-lg-9">
        <div class="card h-100">
          <div class="card-header d-flex align-items-center gap-2">
            <i class="bi bi-folder2-open"></i><span class="fw-bold">현재 경로:</span>
            <nav aria-label="breadcrumb"><ol class="breadcrumb mb-0">
              <template x-for="(seg,i) in breadcrumb" :key="i">
                <li class="breadcrumb-item" :class="{'active': i===breadcrumb.length-1}" x-text="seg"></li>
              </template>
            </ol></nav>
          </div>

          <div class="card-body p-0">
            <div class="p-2 border-bottom bg-light d-flex align-items-center gap-2">
              <input class="form-control form-control-sm" placeholder="이 폴더에서 파일 검색"
                     x-model="filterText" @input.debounce.200ms="applyFilter"/>
              <span class="badge text-bg-secondary ms-auto" x-text="`${filtered.length} files`"></span>
            </div>

            <div class="table-responsive">
              <table class="table table-hover align-middle mb-0">
                <thead class="table-light">
                  <tr>
                    <th style="width:36px;"></th>

                    <!-- 파일명 정렬 -->
                    <th class="sortable" @click="setSort('name')" style="cursor:pointer;">
                      파일명
                      <i class="bi ms-1"
                         :class="sortKey==='name'
                                 ? (sortDir==='asc' ? 'bi-sort-alpha-down' : 'bi-sort-alpha-up')
                                 : 'bi-arrow-down-up'"></i>
                    </th>

                    <th class="text-end" style="width:140px;">크기</th>

                    <!-- 수정시각 정렬 -->
                    <th class="sortable" @click="setSort('mtime')" style="cursor:pointer; width:180px;">
                      수정시각
                      <i class="bi ms-1"
                         :class="sortKey==='mtime'
                                 ? (sortDir==='asc' ? 'bi-sort-down' : 'bi-sort-up')
                                 : 'bi-arrow-down-up'"></i>
                    </th>
                  </tr>
                </thead>
                <tbody>
                  <template x-if="filtered.length===0">
                    <tr><td colspan="4" class="text-center text-muted py-4">파일이 없습니다</td></tr>
                  </template>
                  <template x-for="f in filtered" :key="f.path">
                    <tr class="file-row">
                      <td class="text-center"><i class="bi" :class="fileIcon(f.ext)"></i></td>
                      <td x-text="f.name"></td>
                      <td class="text-end" x-text="f.size || '-'"></td>
                      <td x-text="f.mtime || '-'"></td>
                    </tr>
                  </template>
                </tbody>
              </table>
            </div>

          </div>
        </div>
      </div>

    </div>
  </div>

<script>
function fsApp(){
  const ROOT = 'C:/auto_esafe';

  // 데모 파일 데이터 일부만 (실서비스에선 API 교체)
  const ALL = [
    { name:'auto_esafe_1.1.2.exe', ext:'exe', path:`${ROOT}/auto_esafe_1.1.2.exe`, size:'6.1 MB', mtime:'2025-02-14 07:00' },
    { name:'20250318_500068_T2.xls', ext:'xls', path:`${ROOT}/download/20250318_500068_T2.xls`, mtime:'2025-03-18 07:05' },
    { name:'20250318_500068_T2.xls.csv', ext:'csv', path:`${ROOT}/download/20250318_500068_T2.xls.csv`, mtime:'2025-03-18 07:06' },
    { name:'auto_esafe_2025_03_14.log', ext:'log', path:`${ROOT}/log/auto_esafe_2025_03_14.log`, mtime:'2025-03-14 18:33' },
    { name:'error_2025_07_29_17_31_34.png', ext:'png', path:`${ROOT}/log/error_2025_07_29_17_31_34.png`, mtime:'2025-07-29 17:31' },
  ];

  const immediateChildrenOf = folder => {
    const prefix = folder.endsWith('/') ? folder : folder + '/';
    return ALL.filter(f => f.path.startsWith(prefix) &&
                            f.path.slice(prefix.length).indexOf('/') === -1);
  };

  const findSubfolders = folder => {
    const prefix = folder.endsWith('/') ? folder : folder + '/';
    const set = new Set();
    ALL.forEach(f=>{
      if(!f.path.startsWith(prefix)) return;
      const rest = f.path.slice(prefix.length);
      const seg = rest.split('/')[0];
      if (seg && rest.includes('/')) set.add(prefix + seg);
    });
    return Array.from(set).sort();
  };

  return {
    ROOT,
    selected: ROOT,
    breadcrumb: ['C:','auto_esafe'],
    filterText: '',
    files: [], filtered: [],
    openMap: {},
    subfolders: {},
    sortKey:'name', sortDir:'asc',

    init(){
      this.subfolders[ROOT+'/download'] = findSubfolders(ROOT+'/download');
      this.refreshFiles();
    },

    select(folderPath){
      this.selected = folderPath;
      this.breadcrumb = folderPath
        .replace(/^([A-Za-z]:)\/?/,'$1')
        .split('/')
        .filter(Boolean);

      if (folderPath===ROOT+'/download'){
        this.subfolders[folderPath] = findSubfolders(folderPath);
      }
      this.refreshFiles();
    },

    isOpen(path){ return !!this.openMap[path]; },
    toggle(path){ this.openMap[path] = !this.openMap[path]; },

    refreshFiles(){
      this.files = (this.selected===ROOT) ? immediateChildrenOf(ROOT)
                                          : immediateChildrenOf(this.selected);
      this.applyFilter();
    },

    applyFilter(){
      const q = this.filterText.trim().toLowerCase();
      this.filtered = q ? this.files.filter(f=>(f.name||'').toLowerCase().includes(q))
                        : [...this.files];
      this.applySort();
    },

    setSort(key){
      if (this.sortKey===key){
        this.sortDir = (this.sortDir==='asc')?'desc':'asc';
      }else{
        this.sortKey=key; this.sortDir='asc';
      }
      this.applySort();
    },

    applySort(){
      const key=this.sortKey, dir=this.sortDir;
      const collator=new Intl.Collator('ko-KR',{numeric:true,sensitivity:'base'});
      const cmp=(a,b)=>{
        if(key==='name'){return collator.compare(a.name||'',b.name||'');}
        if(key==='mtime'){return (Date.parse(a.mtime||'')||0)-(Date.parse(b.mtime||'')||0);}
        return 0;
      };
      this.filtered.sort((a,b)=>dir==='asc'?cmp(a,b):-cmp(a,b));
    },

    fileIcon(ext){
      switch((ext||'').toLowerCase()){
        case 'exe': return 'bi-cpu';
        case 'xls': return 'bi-file-earmark-spreadsheet';
        case 'csv': return 'bi-filetype-csv';
        case 'log': return 'bi-journal-text';
        case 'png': return 'bi-filetype-png';
        default: return 'bi-file-earmark';
      }
    }
  };
}
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
